"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateEslintrcJson = void 0;
const rxjs_1 = require("rxjs");
const workspace_1 = require("@nrwl/workspace");
const operators_1 = require("rxjs/operators");
const path_1 = require("path");
const devkit_1 = require("@nrwl/devkit");
const utils_1 = require("@nrwl/workspace/src/schematics/move/lib/utils");
/**
 * Update the .eslintrc file of the project if it exists.
 *
 * @param schema The options provided to the schematic
 */
function updateEslintrcJson(schema) {
    return (tree, _context) => {
        return rxjs_1.from(workspace_1.getWorkspace(tree)).pipe(operators_1.map((workspace) => {
            const destination = utils_1.getDestination(schema, workspace, tree);
            const eslintRcPath = path_1.join(destination, '.eslintrc.json');
            if (!tree.exists(eslintRcPath)) {
                // no .eslintrc found. nothing to do
                return tree;
            }
            const eslintRcJson = JSON.parse(tree.read(eslintRcPath).toString('utf-8'));
            const offset = devkit_1.offsetFromRoot(destination);
            eslintRcJson.extends = offset + '.eslintrc.json';
            tree.overwrite(eslintRcPath, JSON.stringify(eslintRcJson));
            return tree;
        }));
    };
}
exports.updateEslintrcJson = updateEslintrcJson;
//# sourceMappingURL=update-eslintrc-json.js.map